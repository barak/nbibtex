
bindir=$(prefix)/bin
datarootdir=$(prefix)/share
datalibdir=$(prefix)/share/nbibtex

VERSION=$(shell cat VERSION)

OBJS=nbib.o nbibtex.o boyer-moore.o

all: nbibtex
# all: nbib.pdf

nbibtex: $(OBJS)
	$(CC) -o nbibtex $(OBJS) $(LDFLAGS) 

install: nbibtex
	for i in $(datalibdir) $(bindir) $(mandir)/man1; do install -d $(DESTDIR)$$i; done
	install -m644 bibtex.lua natbib.nbs $(DESTDIR)$(datalibdir)/
	install -m644 nbibtex.1 nbibfind.1 $(DESTDIR)$(mandir)/man1/
	install -m755 nbibtex $(DESTDIR)$(bindir)/
	ln --force $(DESTDIR)$(bindir)/nbibtex $(DESTDIR)$(bindir)/nbibfind

uninstall: 
	rm $(DESTDIR)$(datalibdir)/bibtex.lua $(DESTDIR)$(datalibdir)/natbib.nbs
	rm $(DESTDIR)$(mandir)/man1/nbibtex.1 $(DESTDIR)$(mandir)/man1/nbibfind.1
	rm $(DESTDIR)$(bindir)/nbibtex $(DESTDIR)$(bindir)/nbibfind
	rmdir $(DESTDIR)$(datalibdir)

clean:
	rm -f $(OBJS) nbibtex

distclean: clean

nbib.tex: nbib.nw
	noweb -o $<
	sed 's/<VERSION>/$(VERSION)/' < $@ > $@.subst
	mv $@.subst $@

## rubber f = fixedpoint latex f

nbib.pdf: nbib.tex
	rubber --warn=all --verbose --pdf $<

nbib.ps.gz: nbib.tex
	rubber --warn=all --verbose --ps --gzip $<

## NOTES

# Makefile bibtex.lua natbib.nbs nbibtex.1: Makefile.in bibtex.lua.in natbib.nbs.in nbibtex.1.in
# 	./configure --debian
